{% extends "main_layout.html" %}
{% block body %}
<script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<style>
svg {
  position:absolute;
  width:100%;
  height:100%;
  fill:#bfb;
}
#states {
  fill:#a9a9a9;
}
.state_name {
  fill:#CAEBF2;
}
path {
  stroke:#EFEFEF;
  stroke-linejoin:round;
  stroke-linecap:round;
}
</style>
<svg>
  <g id="states"></g>
</svg>
<h4 class="center">the United States in <span class="year">{{year}}</span></h4>
<script>
  var selectedYear = '{{year|safe}}';
  var censusYear = Math.round(selectedYear/10)*10;
  var svgStates = d3.select("svg #states"),states={},startYear=1790,currentYear=censusYear;
  var width = window.innerWidth,height = window.innerHeight;
  var projection = d3.geo.albersUsa().translate([width/2,height/2]);
  var path = d3.geo.path().projection(projection);
  d3.json("/static/json/map_data/states.json", function(error, topologies) {
    if (error) return console.error(error);
    for (var i = 0; i < topologies.length; i++) {
      states[startYear + i * 10] = topojson.feature(topologies[i], topologies[i].objects.stdin);
    }
    svgStates.selectAll("path").data(states[currentYear].features).enter().append("path").attr("d", path);
    svgStates.selectAll(".state_name").data(states[currentYear].features).enter()
      .append("text")
      .attr("class","state_name")
      .attr("transform", function(d) { return "translate(" + path.centroid(d) +")"})
      .attr("dy", ".35em")
      .text(function(d) { return d.properties.STATENAM; });
  });
</script>
{% endblock %}